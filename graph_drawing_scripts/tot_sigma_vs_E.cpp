#include <vector>

#include <TGraphErrors.h>
#include <TAxis.h>
#include <TCanvas.h>
#include <TLegend.h>
#include <TFile.h>

int tot_sigma_vs_E()
{
    TCanvas canv;
    std::vector<double> zeroes(100, 0.0);
    // ********************* Start of Data ********************* //

    // Beam energy [MeV]
    std::vector<double> energy = {919.966, 929.985, 930.481, 934.705, 935.478, 936.305, 937.505, 938.176, 938.323, 938.723, 938.887, 939.467, 939.594, 940.166, 940.207, 940.608, 940.96, 941.882, 941.995, 943.495, 944.817, 944.993, 945.461, 947.5, 949.995, 950.15, 950.29, 950.359, 950.945, 952.012, 953.003, 953.997, 956.084, 960.252, 962.687, 968.805, 970.583, 972.917, 977.158, 980.248, 987.81, 990.293, 1003.5};

    std::vector<double> xsec = {0.0006,0.0032,-0.0003,0.0027,0.0014,0.0013,0.0028,0.0119,0.0893,0.1515,0.1892,0.2312,0.2462,0.2672,0.2648,0.2941,0.2817,0.3034,0.3166,0.3255,0.394,0.3407,0.3804,0.3945,0.3929,0.4882,0.4444,0.5472,0.4123,0.3897,0.4093,0.3276,0.9989,0.8564,1.1865,0.7173,0.7517,0.8842,0.9152,0.7023,0.7781,0.7077,0.7389}; // nb

    std::vector<double> xsec_err = {0.0211, 0.0213, 0.0227, 0.0213, 0.0233, 0.0227, 0.0212, 0.024, 0.0097, 0.0309, 0.0146, 0.0355, 0.0159, 0.0372, 0.016, 0.0392, 0.0169, 0.0483, 0.0178, 0.0176, 0.0391, 0.0173, 0.0198, 0.0182, 0.0387, 0.0765, 0.0316, 0.0979, 0.1618, 0.052, 0.1054, 0.0856, 0.0561, 0.0605, 1.0839, 0.0555, 0.0495, 0.102, 0.3919, 0.0363, 0.0955, 0.0386, 0.007}; // nb
    
    // Spread in c.m.s [MeV]
    std::vector<double> energy_spread = {0.8022469999999999, 0.7996300000000001, 0.677002, 0.6425200000000001, 0.668528, 0.681103, 0.777153, 0.660771, 0.7553300000000001, 0.657032, 0.760046, 0.6850269999999999, 0.766273, 0.649381, 0.7772239999999999, 0.661898, 0.806653, 0.656268, 0.808379, 0.8251229999999999, 0.7108700000000001, 0.814112, 0.6775709999999999, 0.811635, 0.8369949999999999, 0.705808, 0.67391, 0.6792889999999999, 0.824453, 0.822164, 0.813719, 0.825189, 0.716738, 0.698674, 0.703311, 0.821549, 0.727267, 0.746259, 0.8334969999999999, 0.799523, 0.7714289999999999, 0.818357, 0.853053}; //

    // ********************* End of Data ********************* //

    TFile vcs("Results/vcs/vcs_pbarp.root", "recreate");
    for(auto &el : energy) 
    { el = el * 2 * 1e-3; }
    for(auto &el : energy_spread) 
    { el = el * 1e-3; }

    TGraphErrors xsec_vs_energy(energy.size(), energy.data(), xsec.data(), energy_spread.data(), xsec_err.data());
    xsec_vs_energy.SetName("xsec_vs_energy");
    xsec_vs_energy.GetXaxis()->SetTitle("E_{beam}, MeV");
    xsec_vs_energy.GetYaxis()->SetTitle("#sigma_{e^{+}e^{-} #rightarrow p#bar{p}}, nb");
    xsec_vs_energy.SetTitle("Both types of events");

    xsec_vs_energy.DrawClone("AP");

    xsec_vs_energy.SetName("vcs");
    xsec_vs_energy.Write();
    vcs.Save();

    canv.DrawClone();
    return 0;
}